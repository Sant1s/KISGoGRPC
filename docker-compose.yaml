version: '3.7'
services:
    postgresql:
        image: postgres:15-alpine
        container_name: postgresql-kis-task
        environment:
          - POSTGRES_USER=postgres
          - POSTGRES_PASSWORD=postgres
          - POSTGRES_DB=pg_db
          - POSTGRES_PORT=5432
          - PGDATA=/var/lib/postgresql/data/pgdata
        ports:
            - "5432:5432"
        volumes:
            - .postgresql:/var/lib/postgresql/data
        networks:
            - postgres
        restart: unless-stopped

    pgadmin:
        image: dpage/pgadmin4
        container_name: pgadmin-kis-task
        depends_on:
            - postgresql
        environment:
            - PGADMIN_DEFAULT_EMAIL=admin@admin.com
            - PGADMIN_DEFAULT_PASSWORD=root
        volumes:
          - .data_pgadmin:/var/lib/pgadmin
        ports:
          - "8001:80"
        networks:
            - postgres
        restart: unless-stopped

    redis:
      image: redis:latest
      container_name: redis-kis-task
      ports:
        - "6379:6379"
      volumes:
        - .redisdata:/data
        - ./redis.conf:/usr/local/etc/redis/redis.conf  # Подключите файл конфигурации
      command: ["redis-server", "/usr/local/etc/redis/redis.conf"]

    prometheus:
      image: prom/prometheus:latest
      container_name: prometheus-kis-task
      volumes:
        - prometheus:/etc/prometheus/
      hostname: prometheus
      command:
        - --config.file=/etc/prometheus/prometheus.yml
      ports:
        - "9090:9090"
      restart: unless-stopped
      environment:
        TZ: "Europe/Moscow"
      networks:
        - prometheus

    # my-service:
    #     container_name: service
    #     build:
    #         context: ./
    #         dockerfile: Dockerfile
    #     ports:
    #         - "8000:8000"
    #     restart: always


networks:
  postgres:
    driver: bridge
  prometheus:
    driver: bridge

volumes:
  postgres:
  data_pgadmin:
  redis:
  prometheus:

